<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0089)http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		  <!--<base href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message">--><base href=".">
  
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="openjaus, jaus, robotics, as4, jsidl, robot, software, sdk, joint architecture for unmanned systems, unmanned, systems, vehicles, implementation, windows, linux, C++, UGV, UAV, USV, UUV, AGV, AUV, UAS, open, source, FAQ, SAE, AS-4, JSS, JSIDL, JTS">
  <meta name="title" content="Tutorial: Creating an Experimental JAUS Message">
  <meta name="author" content="Danny Kent">
  <meta name="description" content="OpenJAUS.com is the home of a low-cost state-of-the-art toolkit based on the Joint Architecture for Unmanned Systems (JAUS) which is a messaging architecture for robotics. Our software is used by organizations worldwide to help meet hard technical challenges. Everything you need to learn, use and support your JAUS software development needs can be found on this website.">
  <meta name="generator" content="Joomla! 1.5 - Open Source Content Management">
  <title>Tutorial: Creating an Experimental JAUS Message</title>
  <link href="http://openjaus.com/templates/openjaus/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/comments.css" type="text/css">
  <link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/bbcode.css" type="text/css">
  <link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/highlighter.css" type="text/css">
  <style type="text/css">
    <!--

        a.flag {background-image:url('/modules/mod_gtranslate/tmpl/lang/16a.png');}
        a.flag:hover {background-image:url('/modules/mod_gtranslate/tmpl/lang/16.png');}
    
    -->
  </style>
  <script type="text/javascript" async="" src="./Tutorial  Creating an Experimental JAUS Message_files/ga.js"></script><script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/mootools.js"></script>
  <script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/caption.js"></script>
  <script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/validate.js"></script>
  <script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/comments.js"></script>
  <script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/bbcode.js"></script>
  <script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/highlighter.js"></script>
  <script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/jquery-translate.js"></script>
  <script type="text/javascript">
	cOptions = {captcha:1};
	JXLang={INVALID_NAME_TXT:"Please enter a name.",INVALID_EMAIL_TXT:"Please enter a valid e-mail address.",INVALID_BODY_TXT:"Please enter your comment text.",BOLD:"Bold",ITALIC:"Italic",UNDERLINE:"Underline",STRIKETHROUGH:"Strikethrough",QUOTE:"Quote",IMAGE:"Image",ENTER_IMAGE:"Enter Image URL.",ENTER_LINK:"Enter Link URL.",LINK:"Link",LINK_TEXT:"Link Text",ENTER_LANG:"Enter the code language.",CODE:"Code"};
  </script>
  <link type="text/css" rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/shCore.css">
<link type="text/css" rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/shThemeDefault.css">
<script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/shCore.js"></script>
  <script type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/shBrushOj.js"></script>

		<meta name="verify-v1" content="dwFhApTviDugG0lDkfoKRvP6MoI9p+NLAywn0h8wWJI=">
		<link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/system.css" type="text/css">
		<link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/general.css" type="text/css">
		<link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/html.css" type="text/css">
		<link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/joomlaStyles.css" type="text/css">
		<link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/modules.css" type="text/css">
		<link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/style.css" type="text/css">
		<link rel="stylesheet" href="./Tutorial  Creating an Experimental JAUS Message_files/menu.css" type="text/css">

		<script language="javascript" type="text/javascript" src="./Tutorial  Creating an Experimental JAUS Message_files/suckerfish.js"></script>

	<!--[if gte IE 7.0]>
		<style type="text/css">
			.clearfix {display: inline-block;}
		</style>
	<![endif]-->

	</head>
	
	<body>

		<div id="main">
			<!-- BEGIN: HEADER SPACE-->
			<div id="header">

				<a href="http://openjaus.com/"> <img src="./Tutorial  Creating an Experimental JAUS Message_files/openjausLogo.png" border="0"> </a>
			</div>
			<!-- END: HEADER SPACE-->

			<!-- BEGIN: MENUBAR SPACE-->
			<div id="menubar">
				<div id="leftmenu">
					
    <script type="text/javascript">
    //<![CDATA[
    if(jQuery.cookie('glang') && jQuery.cookie('glang') != 'en') jQuery(function($){$('body').translate('en', $.cookie('glang'), {not:'script'});});
    //]]>
    </script>

<script type="text/javascript">
//<![CDATA[
    function doTranslate(lang_pair) {if(lang_pair.value)lang_pair=lang_pair.value;var lang=lang_pair.split('|')[1];if(lang=='pt')lang='pt-PT';jQuery.cookie('glang', lang);jQuery(function($){$('body').translate('en', lang, {not:'script'})});}
//]]>
</script>


<select onchange="doTranslate(this);"><option value="">Select Language</option><option value="en|en" style="font-weight:bold;background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -0px;padding-left:18px;">English</option><option value="en|bg" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -32px;padding-left:18px;">Bulgarian</option><option value="en|zh-CN" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -48px;padding-left:18px;">Chinese (Simplified)</option><option value="en|zh-TW" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -64px;padding-left:18px;">Chinese (Traditional)</option><option value="en|hr" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -80px;padding-left:18px;">Croatian</option><option value="en|cs" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -96px;padding-left:18px;">Czech</option><option value="en|da" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -112px;padding-left:18px;">Danish</option><option value="en|nl" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -128px;padding-left:18px;">Dutch</option><option value="en|fi" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -144px;padding-left:18px;">Finnish</option><option value="en|fr" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -160px;padding-left:18px;">French</option><option value="en|de" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -176px;padding-left:18px;">German</option><option value="en|el" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -192px;padding-left:18px;">Greek</option><option value="en|hi" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -208px;padding-left:18px;">Hindi</option><option value="en|it" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -224px;padding-left:18px;">Italian</option><option value="en|ja" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -240px;padding-left:18px;">Japanese</option><option value="en|ko" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -256px;padding-left:18px;">Korean</option><option value="en|no" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -272px;padding-left:18px;">Norwegian</option><option value="en|pl" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -288px;padding-left:18px;">Polish</option><option value="en|pt" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -304px;padding-left:18px;">Portuguese</option><option value="en|ro" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -320px;padding-left:18px;">Romanian</option><option value="en|ru" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -336px;padding-left:18px;">Russian</option><option value="en|es" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -352px;padding-left:18px;">Spanish</option><option value="en|sv" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -368px;padding-left:18px;">Swedish</option><option value="en|ca" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -384px;padding-left:18px;">Catalan</option><option value="en|tl" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -400px;padding-left:18px;">Filipino</option><option value="en|iw" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -416px;padding-left:18px;">Hebrew</option><option value="en|id" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -432px;padding-left:18px;">Indonesian</option><option value="en|lv" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -448px;padding-left:18px;">Latvian</option><option value="en|lt" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -464px;padding-left:18px;">Lithuanian</option><option value="en|sr" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -480px;padding-left:18px;">Serbian</option><option value="en|sk" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -496px;padding-left:18px;">Slovak</option><option value="en|sl" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -512px;padding-left:18px;">Slovenian</option><option value="en|uk" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -528px;padding-left:18px;">Ukrainian</option><option value="en|vi" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -544px;padding-left:18px;">Vietnamese</option><option value="en|sq" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -560px;padding-left:18px;">Albanian</option><option value="en|et" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -576px;padding-left:18px;">Estonian</option><option value="en|gl" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -592px;padding-left:18px;">Galician</option><option value="en|hu" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -608px;padding-left:18px;">Hungarian</option><option value="en|mt" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -624px;padding-left:18px;">Maltese</option><option value="en|th" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -640px;padding-left:18px;">Thai</option><option value="en|tr" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -656px;padding-left:18px;">Turkish</option><option value="en|fa" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -672px;padding-left:18px;">Persian</option><option value="en|af" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -688px;padding-left:18px;">Afrikaans</option><option value="en|ms" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -704px;padding-left:18px;">Malay</option><option value="en|sw" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -720px;padding-left:18px;">Swahili</option><option value="en|ga" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -736px;padding-left:18px;">Irish</option><option value="en|cy" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -752px;padding-left:18px;">Welsh</option><option value="en|be" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -768px;padding-left:18px;">Belarusian</option><option value="en|is" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -784px;padding-left:18px;">Icelandic</option><option value="en|mk" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -800px;padding-left:18px;">Macedonian</option><option value="en|yi" style="background:url(&#39;/modules/mod_gtranslate/tmpl/lang/16l.png&#39;) no-repeat scroll 0 -816px;padding-left:18px;">Yiddish</option></select> 
				</div>
				<div id="mainmenu" class="clearfix">
					<ul class="menu"><li id="current" class="active item1"><a href="http://d7c.openjaus.com/"><span>Home</span></a></li><li class="item129"><a href="http://openjaus.com/news"><span>News</span></a></li><li class="parent item55"><a href="http://openjaus.com/support"><span>Support</span></a><ul><li class="item130"><a href="http://openjaus.com/support/training"><span>Training &amp; Consulting</span></a></li><li class="item84"><a href="http://openjaus.com/support/forums"><span>Forums</span></a></li><li class="item119"><a href="http://openjaus.com/support/getting-started-with-openjaus"><span>Tutorials</span></a></li><li class="item109"><a href="http://openjaus.com/support/understanding-sae-jaus"><span>Understanding JAUS</span></a></li><li class="item116"><a href="http://openjaus.com/doc/index.html"><span>SDK Documentation</span></a></li><li class="item118"><a href="http://code.google.com/p/openjaus/issues/list"><span>Bug Tracker</span></a></li></ul></li><li class="parent item110"><a href="http://openjaus.com/products/openjaus4"><span>Products</span></a><ul><li class="item111"><a href="http://openjaus.com/products/openjaus4"><span>OpenJAUS 4.0</span></a></li><li class="item113"><a href="http://openjaus.com/products/openjaus33"><span>OpenJAUS 3.3</span></a></li><li class="item112"><a href="http://openjaus.com/products/servicestudio"><span>Service Studio</span></a></li></ul></li><li class="parent item57"><a href="http://openjaus.com/about-us"><span>About Us</span></a><ul><li class="item89"><a href="http://openjaus.com/about-us/contact"><span>Contact</span></a></li><li class="item122"><a href="http://openjaus.com/newsletter-signup"><span>Newsletter</span></a></li></ul></li></ul>
				</div>
			</div>
			<!-- BEGIN: MENUBAR SPACE-->
			
			<!-- BEGIN: TOP BANNER SPACE-->
						<!-- END: TOP BANNER SPACE DK-->

			<!-- BEGIN: BOXES SPACE-->
						<!-- END: BOXES SPACE-->

			
			
			 

			<div id="componentWrapper">
				<table class="contentpaneopen">
<tbody><tr>
		<td class="contentheading" width="100%">
					Tutorial: Creating an Experimental JAUS Message			</td>
				
		
					</tr>
</tbody></table>

<table class="contentpaneopen">



<tbody><tr>
<td valign="top">
<p><!-- Xtypo - Extra Typografi For Joomla Template By http://www.templateplazza.com -->
</p><p style="	background: url(http://openjaus.com/plugins/content/xtypo/icon/warning.gif) center no-repeat; 	background-color: #FBEEF1; background-position: 15px 50%; text-align: left;	padding: 5px 20px 5px 45px; color:#8E6A64; 	border-top: 2px solid #FEABB9 ; 	border-bottom: 2px solid #FEABB9;">
This tutorial is for OpenJAUS 3.3. OpenJAUS 3.3 is no longer in development or maintainence by the OpenJAUS team. This tutorial is provided for reference and support of legacy systems only. For new development please use OpenJAUS 4.0</p><!-- End Xtypo --><p></p>
<hr>
<table border="0" cellspacing="1" cellpadding="1" width="375">
<tbody>
<tr>
<td width="225">Download the code for this example:</td>
<td width="50" align="center">
<p><a href="http://www.dannykent.com/openjaus/media/ExperimentalMessage.zip"><img src="./Tutorial  Creating an Experimental JAUS Message_files/tar-32x32.png" border="0" width="32" height="32"></a><a href="http://www.dannykent.com/openjaus/media/ExperimentalMessage.zip">ExperimentalMessage.zip</a></p>
</td>
</tr>
</tbody>
</table>
<hr>
<div>
<p><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#Introduction">Introduction</a><br> <a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#Part_1:_Defining_a_JAUS_Compatible_Message">Part 1: Defining a JAUS  Compatible Message</a><br> <a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#Part_2:_Implementing_an_Experimental_Message_in_OpenJAUS">Part 2:  Implementing an Experimental Message with OpenJAUS</a></p>
<p><a name="Introduction">Introduction</a></p>
<p style="text-align: justify;">The JAUS standard provides over 200 messages for a large variety of data  and situations. However, sometimes a project or developer just needs something  else. Perhaps the project has a novel sensor algorithm or some new exciting way  to do vehicle control. Often in that situation the developer will look at JAUS  and say "it limits my ability to solve the problem creatively." That is simply not  true though! Rather, JAUS not only provides a standard set of messages to marshal the majority of your unmanned system's data, but also a framework within  which you can easily (and quickly) build new functionality.</p>
<p style="text-align: justify;">For example, lets say we have a new vehicle planning algorithm we want to test. The planning algorithm works by outputting commands as a desired platform  velocity state. We look through our list of JAUS components and messages and see  that there is no driver mechanism for commanding a velocity state. This is a  problem which would lead us to being unable to use the JAUS standard. However,  we can easily build a message which has all the knowledge we need to communicate  in it and use it in our system. We can even use it with other JAUS systems, as  long as they too have the definition of the JAUS message and can implement the  message on their system. If both JAUS systems are built on OpenJAUS, they only  need our source and header files and can compile support into their system  easily! We'll see how to create our source code a bit later in the tutorial. For  now, we will concentrate on defining our custom (experimental) JAUS message. (NOTE:  The need for this particular functionality, velocity state command, is widely  known in the JAUS community and is being incorporated into the next version of  the specification. However it makes a good example for our purposes here.)</p>
<p><a name="Part_1:_Defining_a_JAUS_Compatible_Message">Part 1: Defining a JAUS  Compatible Message</a></p>
<p style="text-align: justify;">To define our JAUS message, we'll want to consider the data within the message  we will need. The JAUS standard defines a set of data types in the Reference  Architecture, Version 3.3, Part 2 in Table 2-1 on page 2. This table is  reproduced below for convenience. This defines all the data members we can use  as we define our custom JAUS message. OpenJAUS provides code to handle the  packing and unpacking of each of these data types to and from byte buffers. When  designing a message, it is also important to understand the concept of Scaled  Integers. Many JAUS messages use scaled integer values and they are discussed in  more detail in Part 2 of the JAUS RA in section 2.2.1. Essentially, given a  upper and lower boundary, a floating point number can be represented as an  integer and converted to and from that integer. This is often used in JAUS to  conserve bandwidth in the message set.</p>
<table border="1" cellspacing="0" cellpadding="0" width="600">
<thead> 
<tr>
<th scope="col">Data Type</th> <th scope="col">Size (in bytes)</th> <th scope="col">Representation</th>
</tr>
</thead> 
<tbody>
<tr>
<td>Byte</td>
<td style="text-align: center;">1</td>
<td>8 bit unsigned integer</td>
</tr>
<tr>
<td>Short Integer</td>
<td style="text-align: center;">2</td>
<td>16 bit signed integer</td>
</tr>
<tr>
<td>Integer</td>
<td style="text-align: center;">4</td>
<td>32 bit signed integer</td>
</tr>
<tr>
<td>Long Integer</td>
<td style="text-align: center;">8</td>
<td>64 bit signed integer</td>
</tr>
<tr>
<td>Unsigned Short Integer</td>
<td style="text-align: center;">2</td>
<td>16 bit unsigned integer</td>
</tr>
<tr>
<td>Unsigned Integer</td>
<td style="text-align: center;">4</td>
<td>32 bit unsigned integer</td>
</tr>
<tr>
<td>Unsigned Long Integer</td>
<td style="text-align: center;">8</td>
<td>64 bit unsigned integer</td>
</tr>
<tr>
<td>Float</td>
<td style="text-align: center;">4</td>
<td>IEEE 32 bit floating point number</td>
</tr>
<tr>
<td>Long Float</td>
<td style="text-align: center;">8</td>
<td>IEEE 64 bit floating point number</td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">For our purposes, we want to design a message to transport a desired velocity  state command. To keep this example simple, we will limit our commanded velocity  state to a common Omega/Velocity control setup, where we are commanding the  linear velocity of the platform and the angular velocity of the platform (this  is often used in skid-steer or differential drive ground vehicles). This means  that we will need to send only two pieces of information, the velocity and the  omega. Both of these data members are going to be real values, so we might chose  to represent them as Floats (from the table above). However, the observant JAUS  developer will notice that VERY few (almost none) of the JAUS messages actually  use floats. They almost all use scaled integers. While the choice of which to  use in an experimental message is ultimately up to the developer and system  needs, it is important to note here that most times a Scaled Integer is  preferred over a Float or a Long Float. To make our example more complex (and  probably more useful), we have chosen to implement our Platform Velocity and  Omega Command message  with scaled integers. The question then is, what is the maximum and minimum  values for our scaled integers? First we will need to define the units that our  values will be expressed in. As with all scientific values, a number is useless  without the corresponding units! Well it happens that in this case, JAUS  provides us with a guide for that. While a developer can easily pick units and  corresponding upper and lower boundary values which make sense to their  particular application, in this case there is a similar JAUS message that  already defines these for us. JAUS does provide a method for reporting the  velocity state of a given platform, the message is Code 4404h: Report Velocity  State. In this message, the velocity of the platform in all six degrees of  freedom is defined. We are only interested in the linear along the major vehicle  axis and the rotation about the vertical axis these are "Velocity X" and "Yaw  Rate" respectively in the Report Velocity State message. From that message we  can see that the velocity is defined as a Scaled Integer reported in "Meters per  Second" which has an upper bound of 65.534 and lower bound of -65.534. Also, yaw  rate is defined as a Scaled Short Integer reported in "Radians per Second" which  has an upper bound of 32.767 and a lower bound of -32.767. (NOTE: The astute  developer will notice a similarity between these boundary values and the maximum  value of a signed integer and signed short respectively. This is not required  and was probably chosen by the JAUS developer for simplicity. Any valid real  value can be used for the upper and lower bound.) So we now have defined our  two fields. While we could certainly call them Field 1 and Field 2, it is often  better to give each some unique name which is easier for human consumption,  let's call them Velocity and Omega.<br> <br> The last thing required to define a JAUS compatible message is to select a  command code. The command code is very important as it identifies your message  and tells other JAUS entities what to expect in the data portion of your  message. JAUS defines a range of command codes which have been set aside for  experimental messages. This range is defined as D000h â€“ FFFFh in Table 3-1 of  the JAUS Reference Architecture, Part 2, Version 3.3. We can choose any value in  that range we like for our message. One important thing to note here is that  your command code is a free choice, as it is for all JAUS developers, so the  chance remains you could always have a conflict with experimental message  command codes in the future if you try to integrate with other JAUS systems  which may have experimental messages as well. For our demonstrative purposes any  command code will suffice, so D000h will be used.</p>
<p style="text-align: left;"><!-- Xtypo - Extra Typografi For Joomla Template By http://www.templateplazza.com -->
</p><div>
	<div style="width:100%;margin:0px auto;background: url(http://openjaus.com/plugins/content/xtypo/rounded3/left.gif) repeat-y left top #247FE6; ">
		<div style=" width:100%;height:20px;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/topleft.gif) no-repeat left top;">
			<span style=" display:block;position:relative;	height:20px;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/topright.gif) no-repeat right top;">&nbsp;</span>
		</div>
		<div style=" position:relative;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/right.gif) repeat-y right top;	padding:1px 20px 1px 25px;	margin:-1px 0 0 0;">
			<div style=" color:#FFFFFF;"><p></p>
<p style="text-align: center;"><strong><span style="font-size: 18px;">Recap</span></strong></p>
<p style="text-align: justify;">To recap, we have defined a custom JAUS message with a command code of D000h  which contains two bits of information a Velocity field which is a scaled  integer and a Omega field which is a scaled short integer. JAUS normally defines  messages in a table format (examples of this can be seen throughout the JAUS  Reference Architecture, Part 3, Version 3.3). We define our message in the same  table format below:</p></div>
		</div>
		<div style=" width:100%;height:20px;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/bottomleft.gif) no-repeat left bottom;">
			<span style=" 	display:block;
	position:relative;
	height:20px;
	background:url(http://openjaus.com/plugins/content/xtypo/rounded3/bottomright.gif) no-repeat right top;">&nbsp;</span>
		</div>
	</div>
</div><!-- End Xtypo --><p></p>
<p style="text-align: left;"><span style="font-size: 18px;"><strong>Code D000h: Platform Velocity and Omega Command</strong></span></p>
<table border="1" cellspacing="0" cellpadding="0" width="700">
<thead> 
<tr>
<th>Field #</th> <th width="100">Name</th> <th>Type</th> <th>Units</th> <th>Interpretation (Note)</th>
</tr>
</thead> 
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td>Velocity</td>
<td>Scaled Integer</td>
<td>Meters per Second</td>
<td>Scaled Integer<br> Lower Limit = -65.534<br> Upper Limit = 65.534</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td>Omega</td>
<td>Scaled Short Integer</td>
<td>Radians per Second</td>
<td>Scaled Integer<br> Lower Limit = -32.767<br> Upper Limit = 32.767</td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">We will now look at how a developer can implement this message using OpenJAUS.  It is important to note before moving on that there are many other mechanisms in  use throughout the JAUS message set to format and organize the data in messages.  Things such as bit fields, enumerations and presence vectors are important  concepts which may have bearing on the design and implementation of a custom  JAUS message. It is left to the developer to find examples of these in the JAUS  message set (there are many) and then explore how these different constructs are  used and implemented in the OpenJAUS code base.</p>
<p><a name="Part_2:_Implementing_an_Experimental_Message_in_OpenJAUS">Part 2:  Implementing an Experimental Message in OpenJAUS</a></p>
<p style="text-align: justify;">Now that our message is well defined, we need to implement it in some source  code. In OpenJAUS there are literally hundreds of messages defined in the  libjaus package. While looking at one of these might make a good example,  OpenJAUS instead provides a more useful mechanism. OpenJAUS provides a  "template" message in the libjaus/src/message folder called  skeletonMessage.c.tmpl and skeletonMessage.h. We will use these templates to  create our Platform Velocity and Omega Command message. First, lets take a look at skeletonMessage.h.<br> <span style="font-family: Courier New;"><script type="text/javascript">
	SyntaxHighlighter.config.clipboardSwf = "http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf";
	SyntaxHighlighter.defaults["auto-links"] = true;
	SyntaxHighlighter.defaults["collapse"] = false;
	SyntaxHighlighter.defaults["gutter"] = true;
	SyntaxHighlighter.defaults["smart-tabs"] = true;
	SyntaxHighlighter.defaults["tab-size"] = 4;
	SyntaxHighlighter.defaults["toolbar"] = true;
	SyntaxHighlighter.defaults["wrap-lines"] = true;	
	SyntaxHighlighter.all();
</script></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_808987" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_808987_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_808987" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// File Name: xXXXMessage.h</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Written By: </code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Version: 3.3.0</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Date: 07/09/08</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Description: This file defines the attributes of a XxXxMessage</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#ifndef XXXX_MESSAGE_H</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="preprocessor">#define XXXX_MESSAGE_H </code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="preprocessor">#include "jaus.h"</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">typedef</code> <code class="keyword bold">struct</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Include all parameters from a JausMessage structure:</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Header Properties</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">struct</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Properties by bit fields</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="preprocessor">#ifdef JAUS_BIG_ENDIAN</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">reserved:2;</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">version:6;</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">expFlag:1;</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">scFlag:1;</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">ackNak:2;</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">priority:4; </code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="preprocessor">#elif JAUS_LITTLE_ENDIAN</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">priority:4; </code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">ackNak:2;</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">scFlag:1; </code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">expFlag:1;</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">version:6; </code></span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">reserved:2;</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="preprocessor">#else</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="preprocessor">#error "Please define system endianess (see jaus.h)"</code></span></span></div><div class="line alt2"><code class="number">32.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="preprocessor">#endif</code></span></span></div><div class="line alt1"><code class="number">33.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}properties;</code></span></span></div><div class="line alt2"><code class="number">34.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">commandCode;</code></span></span></div><div class="line alt1"><code class="number">35.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausAddress</code> <code class="plain">destination;</code></span></span></div><div class="line alt2"><code class="number">36.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausAddress</code> <code class="plain">source;</code></span></span></div><div class="line alt1"><code class="number">37.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausUnsignedInteger</code> <code class="plain">dataSize;</code></span></span></div><div class="line alt2"><code class="number">38.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausUnsignedInteger</code> <code class="plain">dataFlag;</code></span></span></div><div class="line alt1"><code class="number">39.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">sequenceNumber;</code></span></span></div><div class="line alt2"><code class="number">40.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// MESSAGE DATA MEMBERS GO HERE </code></span></span></div><div class="line alt1"><code class="number">41.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Example from ReportGlobalPoseMessage</code></span></span></div><div class="line alt2"><code class="number">42.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">//</code></span></span></div><div class="line alt1"><code class="number">43.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausUnsignedShort presenceVector;</code></span></span></div><div class="line alt2"><code class="number">44.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble latitudeDegrees;&nbsp;&nbsp;&nbsp; // Scaled Int (-90, 90)</code></span></span></div><div class="line alt1"><code class="number">45.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble longitudeDegrees;&nbsp;&nbsp; // Scaled Int (-180, 180)</code></span></span></div><div class="line alt2"><code class="number">46.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble elevationMeters;&nbsp;&nbsp;&nbsp; // Scaled Int (-10000, 35000)</code></span></span></div><div class="line alt1"><code class="number">47.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble positionRmsMeters;&nbsp; // Scaled UInt (0, 100)</code></span></span></div><div class="line alt2"><code class="number">48.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble rollRadians;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Scaled Short (-JAUS_PI, JAUS_PI)</code></span></span></div><div class="line alt1"><code class="number">49.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble pitchRadians;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Scaled Short (-JAUS_PI, JAUS_PI)</code></span></span></div><div class="line alt2"><code class="number">50.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble yawRadians;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Scaled Short (-JAUS_PI, JAUS_PI)</code></span></span></div><div class="line alt1"><code class="number">51.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausDouble attitudeRmsRadians; // Scaled Short (0, JAUS_PI)</code></span></span></div><div class="line alt2"><code class="number">52.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// JausUnsignedInteger timestamp;</code></span></span></div><div class="line alt1"><code class="number">53.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}XxXxMessageStruct;</code></span></span></div><div class="line alt2"><code class="number">54.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">typedef</code> <code class="plain">XxXxMessageStruct* XxXxMessage; </code></span></span></div><div class="line alt1"><code class="number">55.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt2"><code class="number">56.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">XxXxMessage xXXXMessageCreate(</code><code class="keyword bold">void</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">57.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt2"><code class="number">58.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">void</code> <code class="plain">xXXXMessageDestroy(XxXxMessage);</code></span></span></div><div class="line alt1"><code class="number">59.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt2"><code class="number">60.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">JausBoolean</code> <code class="plain">xXXXMessageFromBuffer(XxXxMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code><code class="plain">* buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes);</code></span></span></div><div class="line alt1"><code class="number">61.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt2"><code class="number">62.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">JausBoolean</code> <code class="plain">xXXXMessageToBuffer(XxXxMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code> <code class="plain">*buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes);</code></span></span></div><div class="line alt1"><code class="number">63.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt2"><code class="number">64.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">XxXxMessage xXXXMessageFromJausMessage(</code><code class="color1 bold">JausMessage</code> <code class="plain">jausMessage);</code></span></span></div><div class="line alt1"><code class="number">65.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt2"><code class="number">66.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">JausMessage</code> <code class="plain">xXXXMessageToJausMessage(XxXxMessage message);</code></span></span></div><div class="line alt1"><code class="number">67.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt2"><code class="number">68.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">xXXXMessageSize(XxXxMessage message); </code></span></span></div><div class="line alt1"><code class="number">69.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#endif // XXXX_MESSAGE_H</code></span></span></div></div></div></div> <p></p>
<p style="text-align: justify;">This and the skeletonMessage.c file both use a CaSe SeNsItIvE encoding scheme which allows the developer to easily refactor the skeletonMessage. Three such case sensitive keys are used:</p>
<ol>
<li>"<span style="font-family: Courier New;">XXXX</span>" - this is used as a stand in for defines and should be the name of the message with underscores for spaces between words, for example: <span style="font-family: Courier New;">PLATFORM_VELOCITY_OMEGA_COMMAND</span></li>
<li>"<span style="font-family: Courier New;">XxXx</span>" - this is a the name of the message, starting with a capital letter, for example: <span style="font-family: Courier New;">PlatformVelocityOmegaCommand</span></li>
<li>"<span style="font-family: Courier New;">xXXX</span>" - this is the name of the message, starting with a lower case, for example: <span style="font-family: Courier New;">platformVelocityOmegaCommand</span></li>
</ol>
<p>In all three cases, the word "Message" is omitted as it is included in the template already. A simple find and replace on these (remember case sensitive and not whole word replace) is all that is  required. Also remember to rename your header and source file. The standard practice is to use a lower case naming convention for file names, such as "platformVelocityOmegaCommandMessage.h" Once the name has been properly setup, we need to define our data members. Data members are added after the line "<span style="font-family: Courier New;">MESSAGE DATA MEMBERS GO HERE</span>." In the skeleton files, a short example from the ReportGlobalPoseMessage is included. ReportGlobalPoseMessage is a good example of a complex message which uses a presence vector and a lot of scaled integer values. For our message, we will remove these and replace them with our own data members.</p>
Now we have  platformVelocityOmegaCommand.h which looks like the following:
<p><span style="font-family: Courier New;"></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_864338" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_864338_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_864338" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// File Name: platformVelocityOmegaCommandMessage.h</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Written By: OpenJAUS.com</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Version: 3.3.0</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Date: 07/09/08</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Description: This file defines the attributes of a PlatformVelocityOmegaCommandMessage</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#ifndef PLATFORM_VELOCITY_OMEGA_COMMAND_MESSAGE_H</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="preprocessor">#define PLATFORM_VELOCITY_OMEGA_COMMAND_MESSAGE_H</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#include "jaus.h"</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#define JAUS_PLATFORM_VELOCITY_OMEGA_COMMAND 0xD000</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">typedef</code> <code class="keyword bold">struct</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Include all parameters from a JausMessage structure:</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Header Properties</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">struct</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Properties by bit fields</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#ifdef JAUS_BIG_ENDIAN</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">reserved:2;</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">version:6;</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">expFlag:1;</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">scFlag:1;</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">ackNak:2;</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">priority:4;</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#elif JAUS_LITTLE_ENDIAN</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">priority:4;</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">ackNak:2;</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">scFlag:1;</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">expFlag:1;</code></span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">version:6;</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">reserved:2;</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#else</code></span></span></div><div class="line alt2"><code class="number">32.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="preprocessor">#error "Please define system endianess (see jaus.h)"</code></span></span></div><div class="line alt1"><code class="number">33.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#endif</code></span></span></div><div class="line alt2"><code class="number">34.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}properties;</code></span></span></div><div class="line alt1"><code class="number">35.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">commandCode;</code></span></span></div><div class="line alt2"><code class="number">36.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausAddress</code> <code class="plain">destination;</code></span></span></div><div class="line alt1"><code class="number">37.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausAddress</code> <code class="plain">source;</code></span></span></div><div class="line alt2"><code class="number">38.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausUnsignedInteger</code> <code class="plain">dataSize;</code></span></span></div><div class="line alt1"><code class="number">39.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausUnsignedInteger</code> <code class="plain">dataFlag;</code></span></span></div><div class="line alt2"><code class="number">40.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausUnsignedShort</code> <code class="plain">sequenceNumber;</code></span></span></div><div class="line alt1"><code class="number">41.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// MESSAGE DATA MEMBERS GO HERE</code></span></span></div><div class="line alt2"><code class="number">42.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausDouble</code> <code class="plain">velocityMetersPerSecond;&nbsp;&nbsp;&nbsp; </code><code class="comments">// Scaled Int (-64.534, 65.534)</code></span></span></div><div class="line alt1"><code class="number">43.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausDouble</code> <code class="plain">omegaRadiansPerSecond;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">// Scaled Short (-32.767, 32.767)</code></span></span></div><div class="line alt2"><code class="number">44.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}PlatformVelocityOmegaCommandMessageStruct;</code></span></span></div><div class="line alt1"><code class="number">45.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">typedef</code> <code class="plain">PlatformVelocityOmegaCommandMessageStruct* PlatformVelocityOmegaCommandMessage;</code></span></span></div><div class="line alt2"><code class="number">46.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt1"><code class="number">47.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">PlatformVelocityOmegaCommandMessage platformVelocityOmegaCommandMessageCreate(</code><code class="keyword bold">void</code><code class="plain">);</code></span></span></div><div class="line alt2"><code class="number">48.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt1"><code class="number">49.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">void</code> <code class="plain">platformVelocityOmegaCommandMessageDestroy(PlatformVelocityOmegaCommandMessage);</code></span></span></div><div class="line alt2"><code class="number">50.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt1"><code class="number">51.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">JausBoolean</code> <code class="plain">platformVelocityOmegaCommandMessageFromBuffer(PlatformVelocityOmegaCommandMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code><code class="plain">* buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes);</code></span></span></div><div class="line alt2"><code class="number">52.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt1"><code class="number">53.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">JausBoolean</code> <code class="plain">platformVelocityOmegaCommandMessageToBuffer(PlatformVelocityOmegaCommandMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code> <code class="plain">*buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes);</code></span></span></div><div class="line alt2"><code class="number">54.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt1"><code class="number">55.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">PlatformVelocityOmegaCommandMessage platformVelocityOmegaCommandMessageFromJausMessage(</code><code class="color1 bold">JausMessage</code> <code class="plain">jausMessage);</code></span></span></div><div class="line alt2"><code class="number">56.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt1"><code class="number">57.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">JausMessage</code> <code class="plain">platformVelocityOmegaCommandMessageToJausMessage(PlatformVelocityOmegaCommandMessage message);</code></span></span></div><div class="line alt2"><code class="number">58.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor bold">JAUS_EXPORT</code></span></span></div><div class="line alt1"><code class="number">59.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">platformVelocityOmegaCommandMessageSize(PlatformVelocityOmegaCommandMessage message);</code></span></span></div><div class="line alt2"><code class="number">60.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="preprocessor">#endif // PLATFORM_VELOCITY_OMEGA_COMMAND_MESSAGE_H</code></span></span></div></div></div></div><br> <p></p>
<p style="text-align: justify;"><span style="font-family: Arial;">At this point, one may be wondering to themselves, "I thought our velocity and omega were scaled integers, but here they are defined as a <span style="font-family: Courier New;">JausDouble</span>, why is that?" This is a good observation. In OpenJAUS, all Scaled Integer values are stored in the message data structures as floating point values (<span style="font-family: Courier New;">JausDouble</span>). This is for ease of the end user. The fact that a value is a scaled integer, which is perhaps of interest to the end user, should not make using the data cumbersome to said user. Rather, the user of the data is free to use the message members (in this case velocity and omega) as they would any other floating point value in their code. Only during the process of packing and unpacking a message to a byte buffer is the fact that a value is a signed integer of any significance. We will show how this is accomplished in the source file below. Lastly, there is one more thing we will add to the file. As we will see in the source file, it is necessary to define the command code of our experimental message. This is not part of the standard skeletonMessage template, as typically command codes are defined elsewhere for non-experimental messages. However, it is easier to add them to the header file for our purposes. This is done with the line shown below.</span></p>
<p style="text-align: justify;">#define JAUS_PLATFORM_VELOCITY_OMEGA_COMMAND 0xD000</p>
<p style="text-align: justify;"><span style="font-family: Arial;">Our header file is now complete, as we have converted the skeletonMessage.h file into platformVelocityOmegaCommandMessage.h and added our two data members. We will now look at the accompanying source file and how to implement our message behavior.</span></p>
<p style="text-align: justify;"><span style="font-family: Arial;">Creating the source file from skeletonMessage.c is a similar exercise in find and replace as is done in the header file. Once this is done, the developer need only concentrate on implementing the methods defined in the top part of the source file. Shown below is the part of the file of interest.</span></p>
<p><span style="font-family: Courier New;"></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_617454" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_617454_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_617454" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="keyword bold">const</code> <code class="color1 bold">int</code> <code class="plain">commandCode = JAUS_PLATFORM_VELOCITY_OMEGA_COMMAND;</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// *******************************************************</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// USER CONFIGURED FUNCTIONS</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// *******************************************************</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Initializes the message-specific fields</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="keyword bold">void</code> <code class="plain">dataInitialize(PlatformVelocityOmegaCommandMessage message)</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Set initial values of message fields</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Destructs the message-specific fields</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="keyword bold">void</code> <code class="plain">dataDestroy(PlatformVelocityOmegaCommandMessage message)</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Free message fields</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Return boolean of success</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="color1 bold">JausBoolean</code> <code class="plain">dataFromBuffer(PlatformVelocityOmegaCommandMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code> <code class="plain">*buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes)</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">int</code> <code class="plain">index = 0;</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">if</code><code class="plain">(bufferSizeBytes == message-&gt;dataSize)</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Unpack Message Fields from Buffer</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_TRUE</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">else</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_FALSE</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Returns number of bytes put into the buffer</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="color1 bold">int</code> <code class="plain">dataToBuffer(PlatformVelocityOmegaCommandMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code> <code class="plain">*buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes)</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">32.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">int</code> <code class="plain">index = 0;</code></span></span></div><div class="line alt1"><code class="number">33.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">if</code><code class="plain">(bufferSizeBytes &gt;= dataSize(message))</code></span></span></div><div class="line alt2"><code class="number">34.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">35.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Pack Message Fields to Buffer</code></span></span></div><div class="line alt2"><code class="number">36.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">37.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">return</code> <code class="plain">index;</code></span></span></div><div class="line alt2"><code class="number">38.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">39.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Returns number of bytes put into the buffer</code></span></span></div><div class="line alt2"><code class="number">40.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">dataSize(PlatformVelocityOmegaCommandMessage message)</code></span></span></div><div class="line alt1"><code class="number">41.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">42.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">int</code> <code class="plain">index = 0;</code></span></span></div><div class="line alt1"><code class="number">43.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">return</code> <code class="plain">index;</code></span></span></div><div class="line alt2"><code class="number">44.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div></div> <p></p>
<p style="text-align: justify;"><span style="font-family: Arial;">The first item of interest is the commandCode member. This uses the value defined in the header, which was shown above in the discussion of the header file. Following this is five functions which must be populated by the developer. These five functions define the behavior of the message and how it is packed and unpacked from a byte buffer. The exact implementation of each method for our example is shown below and discussed.</span></p>
<hr>
<p style="text-align: justify;"><span style="font-size: 14px;"><strong>void dataInitialize(...)</strong></span></p>
<p style="text-align: justify;"><span style="font-family: Courier New;"><span style="font-family: Arial;">This function is used to initialize the data members of the message. In our case both our members are simple JausDouble types which are initialized using the newJausDouble() function. Also, note that the properties.expFlag member is initialized to <span style="font-family: Courier New;">JAUS_EXPERIMENTAL_MESSAGE</span>. In the JAUS header there is a field (expFlag) which is used to signify when an experimental message is created. It is important to include this line of code in your experimental messages so other systems know that it is experimental, and not just some undefined message command code.</span></span></p>
<p style="text-align: justify;"><span style="font-family: Courier New;"><span style="font-family: Courier New;"></span></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_881994" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_881994_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_881994" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Initializes the message-specific fields</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="keyword bold">void</code> <code class="plain">dataInitialize(PlatformVelocityOmegaCommandMessage message)</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Experimental message bit</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">message-&gt;properties.expFlag = </code><code class="preprocessor bold">JAUS_EXPERIMENTAL_MESSAGE</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Set initial values of message fields</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">message-&gt;velocityMetersPerSecond = newJausDouble(0.0); </code><code class="comments">// Scaled Int (-65.534, 65.534)</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">message-&gt;omegaRadiansPerSecond = newJausDouble(0.0);&nbsp;&nbsp; </code><code class="comments">// Scaled Short (-32.767, 32.767)</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div></div><span style="font-family: Arial;"><br> </span><p></p>
<hr>
<p style="text-align: justify;"><span style="font-family: Courier New;"> <strong><span style="font-size: 14px;">void dataDestroy(...)</span></strong></span></p>
<p style="text-align: justify;"><span style="font-family: Courier New;"><span style="font-family: Arial;">Sometimes it is necessary to have some dynamic memory allocated as part of a message structure. In that case, that memory should be checked and de-allocated in this function to avoid memory leaks. In this case, there is nothing to be checked.</span></span></p>
<p style="text-align: justify;"><span style="font-family: Courier New;"></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_582097" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_582097_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_582097" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Destructs the message-specific fields</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="keyword bold">void</code> <code class="plain">dataDestroy(PlatformVelocityOmegaCommandMessage message)</code></span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">4.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Free message fields</code></span></span></div><div class="line alt1"><code class="number">5.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="comments">// Nothing to free</code></span></span></div><div class="line alt2"><code class="number">6.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div></div><span style="font-family: Arial;"><br> </span><p></p>
<hr>
<p style="text-align: justify;"><span style="font-family: Courier New;"> <strong><span style="font-size: 14px;">JausBoolean dataFromBuffer(...)</span></strong></span></p>
<p><span style="font-family: Courier New;"><span style="font-family: Arial;">This function defines how our message's data members are populated from a byte buffer. Here we define the behavior of extracting each member of our message from the buffer. Since we are using scaled integer values, the value in the buffer is the scaled integer value and not the real floating point value. Therefore we first extract the data to a temporary variable. We then transform the integer value to a floating point value using the appropriate function (jausIntegerToDouble() for example) and provide it with the upper and lower bounds. This is how the scaling of real numbers from integers is abstracted away from the end-user, allowing them to work without knowledge of the way the data is packaged and transported.</span></span></p>
<p style="text-align: justify;"><span style="font-family: Courier New;"></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_867223" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_867223_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_867223" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Return boolean of success</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="color1 bold">JausBoolean</code> <code class="plain">dataFromBuffer(PlatformVelocityOmegaCommandMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code> <code class="plain">*buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes)</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">int</code> <code class="plain">index = 0;</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausInteger</code> <code class="plain">tempInt = 0;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausShort</code> <code class="plain">tempShort = 0;</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">if</code><code class="plain">(bufferSizeBytes == message-&gt;dataSize)</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Unpack Message Fields from Buffer</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="comments">// Velocity</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">if</code><code class="plain">(!jausIntegerFromBuffer(&amp;tempInt, buffer+index, bufferSizeBytes-index)) </code><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_FALSE</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">index += JAUS_INTEGER_SIZE_BYTES;</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="comments">// Scaled Integer (-65.534, 65.534)</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">message-&gt;velocityMetersPerSecond = jausIntegerToDouble(tempInt, -65.534, 65.534);</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="comments">// Omega</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">if</code><code class="plain">(!jausShortFromBuffer(&amp;tempShort, buffer+index, bufferSizeBytes-index)) </code><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_FALSE</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">index += JAUS_SHORT_SIZE_BYTES;</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="comments">// Scaled Short (-32.767, 32.767)</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">message-&gt;omegaRadiansPerSecond = jausShortToDouble(tempShort, -32.767, 32.767);</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_TRUE</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">else</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_FALSE</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div></div><span style="font-family: Arial;"><br> </span><p></p>
<hr>
<p style="text-align: justify;"><span style="font-family: Courier New;"> <strong><span style="font-size: 14px;">int dataToBuffer(...)</span></strong></span></p>
<p><span style="font-family: Courier New;"><span style="font-family: Arial;">This function defines how a message's data members are packed into a byte buffer. Again, because of the use of scaled integers, a temporary variable is used following the double to integer transformation.</span></span></p>
<p style="text-align: justify;"><span style="font-family: Courier New;"></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_511252" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_511252_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_511252" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Returns number of bytes put into the buffer</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="color1 bold">int</code> <code class="plain">dataToBuffer(PlatformVelocityOmegaCommandMessage message, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">char</code> <code class="plain">*buffer, </code><code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">bufferSizeBytes)</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">int</code> <code class="plain">index = 0;</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausInteger</code> <code class="plain">tempInt = 0;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">JausShort</code> <code class="plain">tempShort = 0;</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">if</code><code class="plain">(bufferSizeBytes &gt;= dataSize(message))</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">{</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Pack Message Fields to Buffer</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="comments">// Velocity</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Scaled Integer (-65.534, 65.534)</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">tempInt = jausIntegerFromDouble(message-&gt;velocityMetersPerSecond, -65.534, 65.534);</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="comments">// pack</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">if</code><code class="plain">(!jausIntegerToBuffer(tempInt, buffer+index, bufferSizeBytes-index)) </code><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_FALSE</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">index += JAUS_INTEGER_SIZE_BYTES;</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="comments">// Omega</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Scaled Short (-32.767, 32.767)</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">tempShort = jausShortFromDouble(message-&gt;omegaRadiansPerSecond, -32.767, 32.767);</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 27px !important;"><code class="keyword bold">if</code><code class="plain">(!jausShortToBuffer(tempShort, buffer+index, bufferSizeBytes-index)) </code><code class="keyword bold">return</code> <code class="preprocessor bold">JAUS_FALSE</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="plain">index += JAUS_SHORT_SIZE_BYTES;</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="keyword bold">return</code> <code class="plain">index;</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div></div><span style="font-family: Arial;"><br> </span><p></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<p style="text-align: justify;"><strong><span style="font-size: 14px;"><span style="font-family: Courier New;">unsigned int dataSize(...)</span></span></strong></p>
<p><span style="font-family: Arial;">This function calculates the number of bytes used by a message's data members. In our example it is quite simple, but in many other JAUS messages various constructs, like loops and presence vectors, cause the size of a message to be quite dynamic. Therefore it is calculated for each message during runtime.</span></p>
<p style="text-align: justify;"><span style="font-family: Courier New;"></span></p><div style="overflow: hidden; display: block; height: auto; width: inherit;"><div id="highlighter_732499" class="syntaxhighlighter "><div class="bar"><div class="toolbar"><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#viewSource" title="view source" style="width: 16px; height: 16px; " class="item viewSource">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_732499_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_732499" menu="false" src="http://openjaus.com/plugins/content/codecitation/scripts/clipboard.swf"></div><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#printSource" title="print" style="width: 16px; height: 16px; " class="item printSource">print</a><a href="http://openjaus.com/products/openjaus33/78-tutorial-creating-an-experimental-jaus-message#about" title="?" style="width: 16px; height: 16px; " class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Returns number of bytes put into the buffer</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword bold">static</code> <code class="color1 bold">unsigned</code> <code class="color1 bold">int</code> <code class="plain">dataSize(PlatformVelocityOmegaCommandMessage message)</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">{</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="color1 bold">int</code> <code class="plain">index = 0;</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Velocity</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">index += JAUS_INTEGER_SIZE_BYTES;</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="comments">// Omega</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;</code><span class="block" style="margin-left: 9px !important;"><code class="plain">index += JAUS_SHORT_SIZE_BYTES;</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;</code><span class="block" style="margin-left: 18px !important;"><code class="keyword bold">return</code> <code class="plain">index;</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div></div><br> <p></p>
<hr>
<p style="text-align: justify;"><!-- Xtypo - Extra Typografi For Joomla Template By http://www.templateplazza.com --></p><p style="	background: url(http://openjaus.com/plugins/content/xtypo/icon/info.gif) center no-repeat; background-color:#F8FAFC ; background-position: 15px 50%; text-align: left; 	padding: 5px 20px 5px 45px; color:#5E6273; border-top: 2px solid #B5D4FE ; border-bottom: 2px solid #B5D4FE;"><strong><span style="font-family: Arial;">A word about Presence Vectors...</span></strong><br> <span style="font-family: Arial;">Throughout this tutorial we have talked several times about something called a presence vector. As defined in the JAUS Reference Architecture JAUS messages may have a mixture of required and optional data fields. A presence vector is used when optional data fields are defined for a message. It provides a bit mapping of optional data fields. At runtime, this bit field is parsed and used to determine which fields are packed or unpacked from a message. Therefore a presence vector, if required, is always the first member of a message. A good example of using a presence vector with OpenJAUS can be seen in the ReportGlobalPoseMessage source file.</span></p><!-- End Xtypo --><p></p>
<p style="text-align: justify;"><!-- Xtypo - Extra Typografi For Joomla Template By http://www.templateplazza.com -->
</p><div>
	<div style="width:100%;margin:0px auto;background: url(http://openjaus.com/plugins/content/xtypo/rounded3/left.gif) repeat-y left top #247FE6; ">
		<div style=" width:100%;height:20px;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/topleft.gif) no-repeat left top;">
			<span style=" display:block;position:relative;	height:20px;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/topright.gif) no-repeat right top;">&nbsp;</span>
		</div>
		<div style=" position:relative;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/right.gif) repeat-y right top;	padding:1px 20px 1px 25px;	margin:-1px 0 0 0;">
			<div style=" color:#FFFFFF;"><p></p>
<p style="text-align: center;"><strong><span style="font-size: 18px;"><span style="font-family: Arial;">Recap</span></span></strong></p>
<p style="text-align: left;"><span style="font-family: Arial;">In this section of the tutorial we have seen how to take the skeletonMessage.c/.h files and refactor them into our custom experimental JAUS message. We have introduced the skeletonMessage files and shown how to replace the keywords with the proper specific message keywords. We have also shown how to define our message's data members in the header file as well as the command code. We have discussed scaled integer values and how OpenJAUS handles them and shown how they are abstracted away from the end-user of our message structure. In the source file, we have covered the five important functions which must be implemented to define our message's behavior and shown a sample implementation for each using our example Platform Velocity and Omega Command message.</span></p></div>
		</div>
		<div style=" width:100%;height:20px;background:url(http://openjaus.com/plugins/content/xtypo/rounded3/bottomleft.gif) no-repeat left bottom;">
			<span style=" 	display:block;
	position:relative;
	height:20px;
	background:url(http://openjaus.com/plugins/content/xtypo/rounded3/bottomright.gif) no-repeat right top;">&nbsp;</span>
		</div>
	</div>
</div><!-- End Xtypo --><p></p>
</div>

</td>
</tr>

</tbody></table>
<span class="article_separator">&nbsp;</span>
<div class="sharing">

	<ul class="sharelist">
		<li>
			<a href="http://del.icio.us/post?url=http%3A%2F%2Fopenjaus.com%2Fcreate-an-experimental-message&title=Tutorial%3A+Creating+an+Experimental+JAUS+Message" target="_blank" title="Share this page with del.icio.us">
				<img src="./Tutorial  Creating an Experimental JAUS Message_files/delicious.gif" alt="del.icio.us">
</a>
		</li>
		<li>
			<a href="http://www.google.com/bookmarks/mark?op=edit&bkmk=http%3A%2F%2Fopenjaus.com%2Fcreate-an-experimental-message&title=Tutorial%3A+Creating+an+Experimental+JAUS+Message" target="_blank" title="Share this page with Google Bookmarks">
				<img src="./Tutorial  Creating an Experimental JAUS Message_files/google_bmarks.gif" alt="Google Bookmarks">
</a>
		</li>
		<li>
			<a href="http://blinklist.com/index.php?Action=Blink/addblink.php&Url=http%3A%2F%2Fopenjaus.com%2Fcreate-an-experimental-message&Title=Tutorial%3A+Creating+an+Experimental+JAUS+Message" target="_blank" title="Share this page with BlinkList">
				<img src="./Tutorial  Creating an Experimental JAUS Message_files/blinklist.gif" alt="BlinkList">
</a>
		</li>
		<li>
			<a href="http://www.facebook.com/share.php?u=http%3A%2F%2Fopenjaus.com%2Fcreate-an-experimental-message" target="_blank" title="Share this page with Facebook">
				<img src="./Tutorial  Creating an Experimental JAUS Message_files/facebook.gif" alt="Facebook">
</a>
		</li>
		<li>
			<a href="http://digg.com/submit?phase=2&url=http%3A%2F%2Fopenjaus.com%2Fcreate-an-experimental-message&title=Tutorial%3A+Creating+an+Experimental+JAUS+Message" target="_blank" title="Share this page with Digg">
				<img src="./Tutorial  Creating an Experimental JAUS Message_files/digg.gif" alt="Digg">
</a>
		</li>
		<li>
			<a href="http://www.stumbleupon.com/submit?url=http%3A%2F%2Fopenjaus.com%2Fcreate-an-experimental-message&title=Tutorial%3A+Creating+an+Experimental+JAUS+Message" target="_blank" title="Share this page with Stumbleupon">
				<img src="./Tutorial  Creating an Experimental JAUS Message_files/stumbleupon.gif" alt="Stumbleupon">
</a>
		</li>
		<li>
			<a href="http://reddit.com/submit?url=http%3A%2F%2Fopenjaus.com%2Fcreate-an-experimental-message&title=Tutorial%3A+Creating+an+Experimental+JAUS+Message" target="_blank" title="Share this page with reddit">
				<img src="./Tutorial  Creating an Experimental JAUS Message_files/reddit.gif" alt="reddit">
</a>
		</li>
	</ul>
    <div class="email">
	    <a href="http://openjaus.com/component/mailto/?tmpl=component&link=aHR0cDovL29wZW5qYXVzLmNvbS9wcm9kdWN0cy9vcGVuamF1czMzLzc4LXR1dG9yaWFsLWNyZWF0aW5nLWFuLWV4cGVyaW1lbnRhbC1qYXVzLW1lc3NhZ2U%3D" title="Email" onclick="window.open(this.href,&#39;win2&#39;,&#39;width=400,height=300,menubar=yes,resizable=yes&#39;); return false;" rel="nofollow">Email this page to a friend.</a>    </div>
</div>

	<div id="comments">
		<h3 id="comments-num">
<span class="numcomments">0</span> Comments		</h3>
		<ol id="commentlist">
					</ol>
	</div>

	<h3 id="leave-response">
		<a href="http://openjaus.com/create-an-experimental-message?scf=1" rel="nofollow {&#39;base&#39;:&#39;http://openjaus.com/&#39;,&#39;thread_id&#39;:&#39;11&#39;}">Add Comment</a>
	</h3>
	<div id="respond-container"></div> 
			</div>

			<div id="footerWrapper">
				<div>Copyright Â© 2012 OpenJAUS. All Rights Reserved.</div>
<div><a href="http://www.joomla.org/">Joomla!</a> is Free Software released under the <a href="http://www.gnu.org/licenses/gpl-2.0.html">GNU/GPL License.</a></div> 
			</div>

		</div>

		<!-- BEGIN: GOOGLE TRACKING -->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25105323-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
		<!-- END: GOOGLE TRACKING -->

	
</body></html>